# HTRC-MetadataService
A simple service for retrieving metadata for a given set of volume IDs

# Build
`sbt clean stage`
Then find the result in `target/universal/stage/`

# Deploy
Copy the folder `target/universal/stage/` to the deployment location and rename as desired (henceforth referred to as `DEPLOY_DIR`).

# Setup
0. Generate an application secret by running `sbt playGenerateSecret`
1. Set `MONGODB_URI` environment variable to point to the Mongo instance holding the metadata
2. Set `METASERVICE_SECRET` environment variable to the value generated by step 0
3. (Optional) Change the value of `metadata-service.max-vols-per-request` in the configuration file

(alternatively, these settings can also be configured by editing `target/universal/stage/conf/application.conf`)

# Run
*Note:* You must have the environment variables set before running (or edited the `application.conf` accordingly)
```bash
$DEPLOY_DIR/bin/htrc-metadataservice -Dhttp.address=HOST -Dhttp.port=PORT -Dplay.http.context=/api
```
where `HOST` is the desired hostname or IP to bind to, and `PORT` is the desired port to run on.

# API

## Request format
```
GET   /api/v2/metadata?ids=ID1|ID2|ID3...
POST  /api/v2/metadata
      where the body contains:
      ID1|ID2|ID3|...
      or
      ID1
      ID2
      ID3
      ...
```

Note: For the POST request, `Content-type: text/plain` must be set in the request

## Response format
```
{
  "found": {
      "hvd.32044038401683": {
        ... content of the JSON metadata file for this volume ...
      },
      "umn.31951p003004858": {
        ... content of the JSON metadata file for this volume ...
      },
      ...
  },
  "missing": [ "hvd.3204403840168x", "badid", ... ]
}
```

Note: The service respects the HTTP `Accept` header.
      The service can return responses in GZIP format by setting `Accept-Encoding: gzip` request header.

# Example

`curl -v -X GET 'http://HOSTNAME:PORT/api/v2/metadata?ids=hvd.32044038401683|SOMEMISSINGID'`

Returns:
```
{
    "found": {
        "hvd.32044038401683": {
            "accessProfile": "google",
            "bibliographicFormat": "BK",
            "classification": {
                "lcc": [
                    "PA258 .B92 1826"
                ],
                "lcc-l": [
                    "743.B988.Ee"
                ]
            },
            "dateCreated": "2017-11-17T23:15:03",
            "enumerationChronology": null,
            "genre": [
                "not fiction"
            ],
            "governmentDocument": false,
            "handleUrl": "http://hdl.handle.net/2027/hvd.32044038401683",
            "hathitrustRecordNumber": 6552339,
            "htBibUrl": "http://catalog.hathitrust.org/api/volumes/full/htid/hvd.32044038401683.json",
            "imprint": "Cummings, Hilliard and Co., 1826.",
            "isbn": null,
            "issn": null,
            "issuance": "monographic",
            "language": "eng",
            "lastUpdateDate": "2012-05-13 19:33:54",
            "lccn": [
                "10024074"
            ],
            "names": [
                "Buttmann, Ph. (Philipp) 1764-1829",
                "Everett, Edward 1794-1865"
            ],
            "oclc": [
                "4050636"
            ],
            "pubDate": 1826,
            "pubDateSource": "Hathifile Pub Date",
            "pubPlace": "mau",
            "rightsAttributes": "pd",
            "schemaVersion": "2.0",
            "sourceInstitution": "HVD",
            "sourceInstitutionRecordNumber": "002855725",
            "subjectCartographics": null,
            "subjectGenre": null,
            "subjectGeographic": null,
            "subjectName": null,
            "subjectOccupation": null,
            "subjectTemporal": null,
            "subjectTitleInfo": null,
            "subjectTopic": [
                "Grammar",
                "Greek language"
            ],
            "title": "Greek grammar for the use of schools / from the German of Philip Buttmann.",
            "typeOfResource": "text",
            "volumeId": "hvd.32044038401683"
        }
    },
    "missing": [
        "SOMEMISSINGID"
    ]
}
```
