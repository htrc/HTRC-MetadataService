# HTRC-MetadataService
A simple service for retrieving metadata for a given set of volume IDs

# Build
`sbt clean stage`
Then find the result in `target/universal/stage/`

# Deploy
Copy the folder `target/universal/stage/` to the deployment location and rename as desired (henceforth referred to as `DEPLOY_DIR`).

# Setup
0. Generate an application secret by running `sbt playGenerateSecret`
1. Set `META_PAIRTREE_ROOT` environment variable to point to the pairtree root of the metadata JSON files
2. Set `METASERVICE_SECRET` environment variable to the value generated by step 0

(alternatively, these settings can also be configured by editing `target/universal/stage/conf/application.conf`)

# Run
*Note:* You must have the environment variables set before running (or edited the `application.conf` accordingly)
```bash
$DEPLOY_DIR/bin/htrc-metadata-service -Dhttp.address=HOST -Dhttp.port=PORT -Dplay.http.context=/api
```
where `HOST` is the desired hostname or IP to bind to, and `PORT` is the desired port to run on.

# API

## Request format
```
GET   /api/v1/metadata?ids=ID1|ID2|ID3...
POST  /api/v1/metadata
      where the body contains:
      ID1|ID2|ID3|...
```

## Response format
```
{
  "status": N,
  "found": [
    {
      "id": "hvd.32044038401683",
      "meta": {
        ... content of the JSON metadata file ...
      }
    }
  ],
  "missing": [
    {
      "id": "hvd.3204403840168x",
      "error": "hvd/pairtree_root/32/04/40/38/40/16/8x/3204403840168x/3204403840168x.json (No such file or directory)"
    }
  ],
  "invalid": [ "SOMEBADID", "ANOTHERBADID" ]
}
```

the value of `N` in the status represents:
  0 = no error
  1 = there are some IDs for which metadata was not found (see the `missing` response key)
  2 = the request contained some invalid IDs (an ID that isn't a valid HTRC id) (see the `invalid` response key)
  3 = there are errors of both type 1 and type 2 (see both `missing` and `invalid` for details)
  
Note: The service respects the HTTP `Accept` header.
      The service can return responses in GZIP format by setting `Accept-Encoding: gzip` request header.

# Example

`curl -v -X GET 'http://HOSTNAME:PORT/api/v1/metadata?ids=hvd.32044038401683|SOMEBADID'`

Returns:
```
{
  "status": 2,
  "found": [
    {
      "id": "hvd.32044038401683",
      "meta": {
        "enumerationChronology": "",
        "handleUrl": "http://hdl.handle.net/2027/hvd.32044038401683",
        "imprint": "Cummings, Hilliard and Co., 1826.",
        "pubPlace": "mau",
        "isbn": [],
        "subjectCartographics": [],
        "subjectOccupation": [],
        "bibliographicFormat": "BK",
        "sourceInstitution": "HVD",
        "subjectTitleInfo": [],
        "hathitrustRecordNumber": "6552339",
        "genre": [
          "not fiction"
        ],
        "htBibUrl": "http://catalog.hathitrust.org/api/volumes/full/htid/hvd.32044038401683.json",
        "subjectName": [],
        "schemaVersion": "1.3",
        "issuance": "monographic",
        "title": "Greek grammar for the use of schools / from the German of Philip Buttmann.",
        "classification": {
          "lcc-l": [
            "743.B988.Ee"
          ],
          "lcc": [
            "PA258 .B92 1826"
          ]
        },
        "pubDate": "1826",
        "subjectTopic": [
          "Greek language",
          "Grammar"
        ],
        "lastUpdateDate": "2012-05-13 19:33:54",
        "subjectGeographic": [],
        "issn": [],
        "sourceInstitutionRecordNumber": "002855725",
        "typeOfResource": "text",
        "subjectGenre": [],
        "dateCreated": "2017-05-25T18:52:48",
        "lccn": [
          "10024074"
        ],
        "accessProfile": "google",
        "language": "eng",
        "names": [
          "Buttmann, Ph. (Philipp) 1764-1829",
          "Everett, Edward 1794-1865"
        ],
        "rightsAttributes": "pd",
        "governmentDocument": "0",
        "subjectTemporal": [],
        "oclc": [
          "4050636"
        ],
        "volumeIdentifier": "hvd.32044038401683"
      }
    }
  ],
  "missing": [],
  "invalid": [
    "SOMEBADID"
  ]
}
```
